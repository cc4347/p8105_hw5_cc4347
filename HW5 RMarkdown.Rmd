---
title: "HW5"
author: "CC"
date: "11/6/2019"
output: github_document
---

# Problem 1: Iris Missing Data

For numeric variables (Sepal.Length, Sepal.Width, Petal.Length, and Petal.Width), fill in missing values with the mean of non-missing values. For the character variable (Species) replace the missing values with "virginica". Use a map statement.

## Loading Dataset
```{r}
library(tidyverse)
library(purrr)

set.seed(10)
iris_with_missing = iris %>%
  map_df(~replace(.x, sample(1:150,20), NA)) %>%
  mutate(Species = as.character(Species))
```

## Cleaning dataset names and trying map statement

```{r}
im = 
iris_with_missing %>%
  janitor::clean_names()

output <- vector("list", length = ncol(iris_with_missing))

na_replace <- function(x) {
  if (is.numeric(x)) {
    replace_na(x, mean(x, na.rm = TRUE))
  } else if (is.character(x)) {
    replace_na(x, "virginica")
  }
}

output = map(iris_with_missing, na_replace)
```

## Different Method

Filling in missing values with a different method. Using summary(im) showed that the mean values for the numeric values were as follows: sepal_length = 5.819, sepal_width = 3.075, petal_length = 3.765, and petal_width = 1.192. Replace individually and recheck summary to ensure NAs no longer present.
```{r}
summary(im)

im$sepal_length <- replace_na(im$sepal_length, 5.819)
im$sepal_width <- replace_na(im$sepal_width, 3.075)
im$petal_length <- replace_na(im$petal_length, 3.765)
im$petal_width <- replace_na(im$petal_width, 1.192)
im$species <- replace_na(im$species, "virginica")

summary(im)
```


# Problem 2: Longitudinal Study

```{r}
list.files(path = "./data/")
```


# Problem 3: Regression

Running models
```{r}
set.seed(10)

sim_regression = function(beta1, n = 30, beta0 = 2, sd =50^(.5)) {
  
  sim_data = tibble(
    x = rnorm(n, mean = 0, sd = 1),
    y = beta0 + beta1 * x + rnorm(n, mean = 0, 50^(.5))
  )
  
  fit_line = lm(y ~ x, data = sim_data) %>% 
    broom::tidy()
  
  tibble(
    b1_estimate = fit_line[[2,2]],
    p_value = fit_line[[2,5]]
  )
}

beta1_list = list("beta1_0 = 0",
                  "beta1_1" = 1,
                  "beta1_2" = 2,
                  "beta1_3" = 3,
                  "beta1_4" = 4,
                  "beta1_5" = 5,
                  "beta1_6" = 6)

set.seed(1)

sim_results = rerun(10000, sim_regression(beta1 = 0)) %>%
  bind_rows()

sim_results
```

```{r}
results_10k =
  tibble(b1 = c(0, 1, 2, 3, 4, 5, 6)) %>%
  mutate(
    output_lists = map(.x = beta1_list, ~rerun(10000, sim_regression(beta1 = .x))),
    output_df = map(output_lists, bind_rows)) %>%
  select(-output_lists) %>%
  unnest(output_df)
```


Plotting proportion of times the null was rejected (i.e. power) on y-axis and true value of Beta1 on x axis. Describe the association between effect size and power.
```{r}
results_10k %>%
  mutate(reject = ifelse(p_value < 0.05, "yes", "no"), reject = as.factor(reject)) %>%
  group_by(b1, reject) %>%
  count(reject) %>%
  mutate(freq = (n/100)) %>%
  filter(reject == "yes") %>%
  ggplot() +
  labs(title = "Association Between Power and Effect Size",
       x = "Beta1 True Value",
       y = "Power")
```

Plot average estimates of Beta1hat on y-axis and true values of Beta1 on x-axis. On separate plot, show average estimate of Beta1hat in samples for which the null was rejected on the y-axis and the true value of Beta1 on the x axis. 
```{r}
graph_1 = 
  results_10k %>%
  mutate(reject = ifelse(p_value < 0.05, "yes", "no"),
         reject = as.factor(reject)) %>%
  group_by(b1) %>%
  summarise(est_b1_mean = mean(b1_estimate)) %>%
  ggplot(aes(x = b1, y = est_b1_mean)) + geom_point() +
  labs(title = "Mean Beta1 Estimate Against True Beta1 in All Observations",
       x = "Beta1 True Value",
       y = "Beta1 Mean Estimate")

graph_2 =
  results_10k %>%
  mutate(reject = ifelse(p_value < 0.05, "yes", "no"),
         reject = as.factor(reject)) %>%
  group_by(b1) %>%
  filter(reject == "yes") %>%
  summarise(est_b1_mean = mean(b1_estimate)) %>%
  ggplot(aes(x = b1, y = est_b1_mean)) + geom_point() +
  labs(title = "Mean Beta1 Estimate Against True Beta1 In Rejected Cases",
       x = "Beta1 True Value",
       y = "Beta1 Mean Estimate")
```


```{r}
graph_1
```


```{r}
graph_2
```